# 音频片段下发协议（统一标准）

本项目的下行音频（服务器 -> 客户端）统一采用如下协议：

- 每个 UDP 包负载即为一个可独立播放的 MP3 片段（无需重组，无自定义分片头）
- 片段顺序由服务器保证：按语义顺序依次发送，相邻发送间隔约 0.2 秒
- 客户端只负责：接收 -> 入队 -> 串行播放
- 协议封装：沿用 ADPCMProtocol 外层封装 [1字节类型][4字节长度][负载]，类型为 COMPRESSION_TTS_MP3

## 发送侧（Server）

1. 将文本流切句（必要时再细分）
2. 对每句调用 TTS，产出 MP3 字节
3. 若单句 MP3 超过安全上限（约 58KB），按文本再次细分生成多个更小片段
4. 按顺序逐段发送，每段之间 sleep(0.2s)

## 接收侧（Client）

- 接收线程：收到 COMPRESSION_TTS_MP3 负载后，直接丢入播放队列
- 播放线程：从队列中取一个片段，阻塞播放直至结束，再取下一个

## 兼容说明

- 旧的“4 字节分片头（总片数/序号）+ 原始字节块”的方案已废弃
- 若需回退，请从版本控制恢复旧逻辑；主干仅保留统一标准实现


